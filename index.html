<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#1a1a1a">
    <title>NEXUS TRANSIT</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* * ------------------------------------------------------------------
         * DESIGN SYSTEM: "MIDNIGHT GLASS"
         * ------------------------------------------------------------------
         */
        :root {
            --surface-dark: #121212;
            --surface-card: #1e1e1e;
            --surface-float: rgba(30, 30, 30, 0.85);
            --border-subtle: rgba(255, 255, 255, 0.08);
            
            --primary: #3b82f6; /* Modern Blue */
            --primary-glow: rgba(59, 130, 246, 0.4);
            
            --text-main: #ffffff;
            --text-secondary: #9ca3af;
            
            --hsl-blue: #007ac9;
            --hsl-orange: #ff6319;
            --hsl-purple: #8c4799;
            --hsl-green: #00985f;

            --radius-lg: 24px;
            --radius-md: 16px;
            --radius-sm: 8px;
            
            --shadow-float: 0 8px 32px rgba(0, 0, 0, 0.4);
            --ease-spring: cubic-bezier(0.4, 0.0, 0.2, 1);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0;
            font-family: 'Plus Jakarta Sans', -apple-system, sans-serif;
            background: var(--surface-dark);
            color: var(--text-main);
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }

        /* --- MAP LAYER --- */
        #map-container {
            position: absolute; inset: 0; z-index: 0;
            filter: brightness(0.85) contrast(1.1);
        }

        /* --- UI OVERLAY STRUCTURE --- */
        .ui-layer {
            position: absolute; inset: 0; z-index: 10;
            pointer-events: none; /* Allows clicks to pass to map */
            display: flex; flex-direction: column;
            justify-content: space-between;
        }

        .pointer-active { pointer-events: auto; }

        /* --- TOP SEARCH BAR (Floating) --- */
        .search-container {
            padding: 16px 20px;
            padding-top: max(16px, env(safe-area-inset-top));
            display: flex; gap: 12px; align-items: center;
        }

        .search-bar {
            flex: 1;
            background: var(--surface-float);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--border-subtle);
            height: 52px;
            border-radius: var(--radius-lg);
            display: flex; align-items: center;
            padding: 0 20px;
            box-shadow: var(--shadow-float);
            transition: transform 0.2s var(--ease-spring);
        }

        .search-bar:active { transform: scale(0.98); }

        .search-icon { width: 20px; height: 20px; color: var(--text-secondary); margin-right: 12px; }
        
        .search-input {
            background: transparent; border: none; color: white;
            font-family: inherit; font-size: 16px; width: 100%;
            font-weight: 500;
        }
        .search-input::placeholder { color: var(--text-secondary); }
        .search-input:focus { outline: none; }

        .profile-btn {
            width: 52px; height: 52px;
            background: var(--surface-float);
            backdrop-filter: blur(16px);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            box-shadow: var(--shadow-float);
            border: 1px solid var(--border-subtle);
        }

        /* --- BOTTOM SHEET (The core of modern UI) --- */
        .bottom-sheet {
            background: var(--surface-card);
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.5);
            max-height: 85vh;
            min-height: 200px;
            transition: transform 0.3s var(--ease-spring);
            display: flex; flex-direction: column;
            border-top: 1px solid var(--border-subtle);
        }

        .sheet-handle-area {
            height: 24px; display: flex; align-items: center; justify-content: center;
            padding-top: 8px; cursor: grab;
        }

        .sheet-handle {
            width: 40px; height: 4px; background: rgba(255,255,255,0.2);
            border-radius: 4px;
        }

        .sheet-content {
            padding: 0 24px 32px 24px;
            overflow-y: auto;
        }

        .section-title {
            font-size: 13px; font-weight: 700; color: var(--text-secondary);
            text-transform: uppercase; letter-spacing: 0.5px;
            margin-bottom: 16px; margin-top: 10px;
        }

        /* --- TRANSIT CARDS --- */
        .transit-card {
            background: rgba(255,255,255,0.03);
            border-radius: var(--radius-md);
            padding: 16px;
            margin-bottom: 12px;
            display: flex; align-items: center; justify-content: space-between;
            transition: background 0.2s;
            cursor: pointer;
        }

        .transit-card:active { background: rgba(255,255,255,0.08); }

        .line-badge {
            min-width: 48px; height: 36px;
            border-radius: var(--radius-sm);
            display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 16px; color: white;
            margin-right: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        /* Official HSL Colors */
        .bg-bus { background: var(--hsl-blue); }
        .bg-metro { background: var(--hsl-orange); }
        .bg-train { background: var(--hsl-purple); }
        .bg-tram { background: var(--hsl-green); }

        .route-info { flex: 1; }
        .route-dest { font-size: 16px; font-weight: 600; margin-bottom: 4px; }
        .route-meta { font-size: 13px; color: var(--text-secondary); display: flex; align-items: center; gap: 6px; }

        .live-time {
            text-align: right;
        }
        .time-main { font-size: 18px; font-weight: 700; color: var(--primary); }
        .time-sub { font-size: 12px; color: var(--text-secondary); }

        /* --- SKELETON LOADING (Premium Feel) --- */
        .skeleton {
            background: linear-gradient(90deg, #1e1e1e 25%, #2a2a2a 50%, #1e1e1e 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 4px;
        }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

        /* --- GPS FAB (Floating Action Button) --- */
        .fab-gps {
            position: absolute; right: 20px; bottom: 240px; /* Above sheet */
            width: 50px; height: 50px;
            background: var(--surface-card);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            box-shadow: var(--shadow-float);
            color: white; border: 1px solid var(--border-subtle);
            transition: 0.2s;
        }
        .fab-gps:active { transform: scale(0.9); }

        /* --- SPLASH SCREEN --- */
        #splash {
            position: fixed; inset: 0; background: #000; z-index: 9999;
            display: flex; align-items: center; justify-content: center; flex-direction: column;
            transition: opacity 0.5s;
        }
        .splash-logo { font-size: 32px; font-weight: 800; letter-spacing: -1px; background: linear-gradient(45deg, #fff, #666); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

    </style>
</head>
<body>

    <div id="splash">
        <div class="splash-logo">NEXUS</div>
        <div style="margin-top:20px; width:40px; height:4px; background:#333; border-radius:2px; overflow:hidden;">
            <div style="width:100%; height:100%; background:var(--primary); animation: shimmer 1s infinite;"></div>
        </div>
    </div>

    <div id="map-container"></div>

    <div class="ui-layer">
        
        <div class="search-container pointer-active">
            <div class="search-bar">
                <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                <input type="text" class="search-input" placeholder="Mihin haluat mennä?" id="dest-input">
            </div>
            <div class="profile-btn" onclick="App.toggleTheme()">
                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
            </div>
        </div>

        <div class="fab-gps pointer-active" onclick="App.centerUser()">
            <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
        </div>

        <div class="bottom-sheet pointer-active">
            <div class="sheet-handle-area">
                <div class="sheet-handle"></div>
            </div>
            <div class="sheet-content">
                <div class="section-title">Lähimmät lähdöt</div>
                
                <div id="departures-list">
                    </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        /**
         * NEXUS CORE ENGINE
         * High-performance UI Controller & Mock Data Service
         */

        const CONFIG = {
            colors: {
                bus: '#007ac9',
                metro: '#ff6319',
                train: '#8c4799',
                tram: '#00985f',
                user: '#3b82f6'
            }
        };

        class TransitApp {
            constructor() {
                this.map = null;
                this.userMarker = null;
                this.mockData = [
                    { id: '500', type: 'bus', dest: 'Munkkivuori', min: 2, crowded: false },
                    { id: 'M1', type: 'metro', dest: 'Vuosaari', min: 4, crowded: true },
                    { id: 'I', type: 'train', dest: 'Lentoasema', min: 7, crowded: false },
                    { id: '9', type: 'tram', dest: 'Länsiterminaali', min: 11, crowded: false },
                    { id: '510', type: 'bus', dest: 'Westendinasema', min: 14, crowded: false },
                    { id: 'K', type: 'train', dest: 'Kerava', min: 18, crowded: true },
                ];
            }

            init() {
                setTimeout(() => {
                    document.getElementById('splash').style.opacity = '0';
                    setTimeout(() => document.getElementById('splash').remove(), 500);
                }, 2000); // Fake load time for branding effect

                this.initMap();
                this.renderSkeletons();
                this.initSearch();
                
                // Simulate fetching data
                setTimeout(() => {
                    this.renderList();
                }, 2500);
            }

            initMap() {
                // Leaflet with CartoDB Dark Matter (Premium look)
                this.map = L.map('map-container', {
                    zoomControl: false,
                    attributionControl: false
                }).setView([60.1699, 24.9384], 14);

                L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                    maxZoom: 19
                }).addTo(this.map);

                // Start GPS
                this.centerUser();
            }

            centerUser() {
                if(navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(pos => {
                        const { latitude, longitude, accuracy } = pos.coords;
                        
                        // Custom User Dot (Pulse effect in CSS/SVG)
                        if(this.userMarker) this.userMarker.remove();
                        
                        const icon = L.divIcon({
                            className: 'user-location-dot',
                            html: `
                                <div style="
                                    width: 16px; height: 16px; background: ${CONFIG.colors.user}; 
                                    border: 3px solid white; border-radius: 50%; 
                                    box-shadow: 0 0 20px ${CONFIG.colors.user};">
                                </div>`,
                            iconSize: [20, 20]
                        });

                        this.userMarker = L.marker([latitude, longitude], {icon}).addTo(this.map);
                        this.map.flyTo([latitude, longitude], 15, { duration: 1.5 });

                        // Add accuracy circle
                        L.circle([latitude, longitude], {
                            radius: accuracy,
                            color: CONFIG.colors.user,
                            fillOpacity: 0.1,
                            weight: 1
                        }).addTo(this.map);

                    }, () => alert('Sijaintia ei saatu.'));
                }
            }

            initSearch() {
                const input = document.getElementById('dest-input');
                input.addEventListener('change', () => {
                    const val = input.value;
                    if(val) {
                        // Simulate route calculation
                        this.map.flyTo([60.1719, 24.9414], 14); // Fly to Railway Station
                        // Simulate adding a route line
                        const route = [[60.1699, 24.9384], [60.175, 24.94], [60.1719, 24.9414]];
                        L.polyline(route, {color: CONFIG.colors.user, weight: 5, opacity: 0.8}).addTo(this.map);
                    }
                });
            }

            renderSkeletons() {
                const container = document.getElementById('departures-list');
                let html = '';
                for(let i=0; i<3; i++) {
                    html += `
                    <div class="transit-card" style="pointer-events: none;">
                        <div class="skeleton" style="width: 48px; height: 36px; margin-right: 16px;"></div>
                        <div style="flex: 1;">
                            <div class="skeleton" style="width: 60%; height: 16px; margin-bottom: 8px;"></div>
                            <div class="skeleton" style="width: 40%; height: 12px;"></div>
                        </div>
                    </div>`;
                }
                container.innerHTML = html;
            }

            renderList() {
                const container = document.getElementById('departures-list');
                container.innerHTML = '';

                this.mockData.forEach(item => {
                    let bgClass = 'bg-bus';
                    if(item.type === 'metro') bgClass = 'bg-metro';
                    if(item.type === 'train') bgClass = 'bg-train';
                    if(item.type === 'tram') bgClass = 'bg-tram';

                    const el = document.createElement('div');
                    el.className = 'transit-card pointer-active';
                    el.onclick = () => this.selectRoute(item);
                    el.innerHTML = `
                        <div class="line-badge ${bgClass}">${item.id}</div>
                        <div class="route-info">
                            <div class="route-dest">${item.dest}</div>
                            <div class="route-meta">
                                <span>Laituri 12</span> • 
                                <span style="color: ${item.crowded ? '#ef4444' : '#10b981'}">
                                    ${item.crowded ? 'Ruuhkainen' : 'Väljää'}
                                </span>
                            </div>
                        </div>
                        <div class="live-time">
                            <div class="time-main">${item.min} <span style="font-size:12px">min</span></div>
                            <div class="time-sub">12:42</div>
                        </div>
                    `;
                    container.appendChild(el);
                });
            }

            selectRoute(item) {
                // Animation for selection
                navigator.vibrate(50); // Haptic feedback
                alert(`Valittu reitti: ${item.id} kohteeseen ${item.dest}`);
            }

            toggleTheme() {
                // Future feature: Light mode toggle
                alert("Profiili ja asetukset -valikko");
            }
        }

        const App = new TransitApp();
        window.onload = () => App.init();

    </script>
</body>
</html>
